(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2adf8b3a"],{"28dc":function(t,e,n){"use strict";var r=n("4fc5"),a=n.n(r);a.a},"2cda":function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"ActivityJoin"}},[n("div",{staticClass:"form"},[n("div",{staticClass:"formLeft"},[n("el-input",{attrs:{placeholder:"請輸入職編/學號/姓名"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.search(e))}},model:{value:t.searchData.key,callback:function(e){t.$set(t.searchData,"key",e)},expression:"searchData.key"}}),n("div",{staticClass:"formButtonList"},[n("el-button",{attrs:{type:"primary"},on:{click:t.search}},[t._v("搜尋")])],1)],1)]),n("div",{staticClass:"table"},[n("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{"header-cell-class-name":"tableHeader",data:t.MemberList},on:{"selection-change":t.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"55"}}),n("el-table-column",{attrs:{label:"#"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.$index+1))]}}])}),n("el-table-column",{attrs:{label:"職編/學號",prop:"Account",sortable:""}}),n("el-table-column",{attrs:{label:"姓名",prop:"Name",sortable:""}})],1)],1),t.changeList.length?n("div",{staticClass:"formButtonList"},[n("el-button",{attrs:{type:"primary"},on:{click:t.subWithMail}},[t._v("儲存並發送郵件")]),n("el-button",{attrs:{type:"primary"},on:{click:t.sub}},[t._v("儲存並返回")])],1):t._e()])},a=[],i=n("a34a"),s=n.n(i);function c(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=o(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){c=!0,i=t},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw i}}}}function o(t,e){if(t){if("string"===typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function u(t,e,n,r,a,i,s){try{var c=t[i](s),o=c.value}catch(l){return void n(l)}c.done?e(o):Promise.resolve(o).then(r,a)}function d(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var i=t.apply(e,n);function s(t){u(i,r,a,s,c,"next",t)}function c(t){u(i,r,a,s,c,"throw",t)}s(void 0)}))}}var f={props:["data"],data:function(){return{ActivityData:"",MemberList:[],FormData:"",searchData:{key:""},form:{},changeUnit:"",changeList:[],UnitList:[]}},computed:{getMember:function(){var t=this;return this.MemberList.filter((function(e){return e.UnitCode==t.changeUnit}))}},created:function(){var t=this;return d(s.a.mark((function e(){return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$api.GetActivityById({Id:t.data.Id}).then((function(t){return t.data.response}));case 2:return t.ActivityData=e.sent,e.next=5,t.$api.GetFormById({Id:t.data.FormId}).then((function(t){return t.data.response}));case 5:return t.FormData=e.sent,e.next=8,t.$api.GetUnits().then((function(t){return t.data}));case 8:t.UnitList=e.sent,t.form.ActivityId=t.data.Id;case 10:case"end":return e.stop()}}),e)})))()},methods:{sub:function(){var t=this;return d(s.a.mark((function e(){var n,r,a,i,o,l,u,d,f,m,p;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$store.dispatch("loadingHandler",!0),n=c(t.changeList),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=25;break}return a=r.value,e.next=8,t.$api.GetByAccount({account:a.Account}).then((function(t){return t.data.response}));case 8:return i=e.sent,o={id:0,memberId:i.Id,activityId:t.ActivityData.Id,status:0,joinType:2},e.next=12,t.$api.PostActivityRegister(o).then((function(t){return t.data}));case 12:if(l=e.sent,!l.success){e.next=22;break}u=[],d=c(t.FormData.FormDtlDTO);try{for(d.s();!(f=d.n()).done;)m=f.value,p={}," "==m.MemberColumn&&(m.MemberColumn=null),p=m.MemberColumn?{ActivityRegisterId:l.response,FormDtlId:m.Id,Id:m.Id,inputVal:i[m.MemberColumn]}:{ActivityRegisterId:l.response,FormDtlId:m.Id,Id:m.Id,inputVal:""},u.push(p)}catch(s){d.e(s)}finally{d.f()}return e.next=19,t.$api.PostActivityRegisterDtl(u).then((function(t){return t.data}));case 19:e.sent,e.next=23;break;case 22:t.$alertM.fire({icon:"error",title:"'"+i.UserName+"'"+l.msg});case 23:e.next=4;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e["catch"](2),n.e(e.t0);case 30:return e.prev=30,n.f(),e.finish(30);case 33:t.$alertM.fire({icon:"success",title:"批量報名完成"}),t.$refs.table.clearSelection(t.changeList),t.searchData.key="",t.$store.dispatch("loadingHandler",!1);case 37:case"end":return e.stop()}}),e,null,[[2,27,30,33]])})))()},subWithMail:function(){var t=this;return d(s.a.mark((function e(){var n,r,a,i,o,l,u,d,f,m,p;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$store.dispatch("loadingHandler",!0),n=c(t.changeList),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=25;break}return a=r.value,e.next=8,t.$api.GetByAccount({account:a.Account}).then((function(t){return t.data.response}));case 8:return i=e.sent,o={id:0,memberId:i.Id,activityId:t.ActivityData.Id,status:0,joinType:2},e.next=12,t.$api.PostAndSendMail(o).then((function(t){return t.data}));case 12:if(l=e.sent,!l.success){e.next=22;break}u=[],d=c(t.FormData.FormDtlDTO);try{for(d.s();!(f=d.n()).done;)m=f.value,p={}," "==m.MemberColumn&&(m.MemberColumn=null),p=m.MemberColumn?{ActivityRegisterId:l.response,FormDtlId:m.Id,Id:m.Id,inputVal:i[m.MemberColumn]}:{ActivityRegisterId:l.response,FormDtlId:m.Id,Id:m.Id,inputVal:""},u.push(p)}catch(s){d.e(s)}finally{d.f()}return e.next=19,t.$api.PostActivityRegisterDtl(u).then((function(t){return t.data}));case 19:e.sent,e.next=23;break;case 22:t.$alertM.fire({icon:"error",title:"'"+i.UserName+"'"+l.msg});case 23:e.next=4;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e["catch"](2),n.e(e.t0);case 30:return e.prev=30,n.f(),e.finish(30);case 33:t.$alertM.fire({icon:"success",title:"批量報名完成"}),t.$refs.table.clearSelection(t.changeList),t.searchData.key="",t.$store.dispatch("loadingHandler",!1);case 37:case"end":return e.stop()}}),e,null,[[2,27,30,33]])})))()},search2:function(){console.log("wayne?")},search:function(){var t=this;return d(s.a.mark((function e(){return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$store.dispatch("loadingHandler",!0),e.next=3,t.$api.GetAdminUserByKey(t.searchData).then((function(t){return t.data.response}));case 3:t.MemberList=e.sent,t.$store.dispatch("loadingHandler",!1);case 5:case"end":return e.stop()}}),e)})))()},handleSelectionChange:function(t){this.changeList=t}}},m=f,p=(n("64db"),n("2877")),h=Object(p["a"])(m,r,a,!1,null,"b25b4bdc",null);e["a"]=h.exports},"4fc5":function(t,e,n){},"5ae2":function(t,e,n){"use strict";var r=n("81e1"),a=n.n(r);a.a},"64db":function(t,e,n){"use strict";var r=n("e6dd"),a=n.n(r);a.a},"81e1":function(t,e,n){},"8a48":function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"CertificatePreview"},[n("div",{staticStyle:{display:"flex","justify-content":"center"}},[n("div",{ref:"printBox",staticClass:"CertificatePreviewBox"},[n("img",{staticClass:"CertificatePreviewImg",attrs:{src:t.$store.state.fileBase+"Files/"+t.img}}),t.textReal?n("div",{staticClass:"CertificatePreviewText",domProps:{innerHTML:t._s(t.textReal)}}):t._e()])]),n("div",{staticClass:"formButtonList"},[t._e()],1)])},a=[],i=n("c1df"),s=n.n(i),c={props:["user","act","img","text"],data:function(){return{}},computed:{textReal:function(){var t=this,e=this.text;return e=e.replace(/%cmname/gm,this.user.UserName),e=e.replace(/%name/gm,this.act.ActName),e=e.replace(/%unit/gm,this.act.ActOrganizer),e=e.replace(/%actcg/gm,this.$store.state.actType.filter((function(e){return e.Id==t.act.ActTypeId}))[0].title),e=e.replace(/%acttype/gm,this.$store.state.actCategory.filter((function(e){return e.Id==t.act.ActCategoryId}))[0].title),e=e.replace(/%area/gm,this.act.ActAddr),e=e.replace(/%begin/gm,this.YYYYMMDDhhmmss(this.act.ActStartDate)),e=e.replace(/%end/gm,this.YYYYMMDDhhmmss(this.act.ActEndDate)),e=e.replace(/%hours/gm,this.act.ActTime),e=e.replace(/%regNo/gm,this.user.regNo),console.log(e),e}},methods:{toPrint:function(){document.body.innerHTML=this.$refs.printBox.innerHTML,window.print()},YYYYMMDDhhmmss:function(t){return s()(t).format("YYYY-MM-DD HH:mm:ss")}}},o=c,l=(n("5ae2"),n("2877")),u=Object(l["a"])(o,r,a,!1,null,"7817ad31",null);e["a"]=u.exports},"91a8":function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"CertificateContent"}},[n("el-dialog",{attrs:{"close-on-click-modal":!1,title:"編輯底稿",visible:t.showForm,width:"1000px"},on:{"update:visible":function(e){t.showForm=e}}},[n("el-form",{ref:"form",attrs:{"label-width":"150px",model:t.form}},[n("div",{staticStyle:{display:"flex","justify-content":"center",padding:"0 0 20px 0"}},[n("el-button",{attrs:{type:"primary"},on:{click:function(e){t.showRowList=!t.showRowList}}},[t._v("常用插入欄位")])],1),t.showRowList?n("div",{staticClass:"CertificateContentText"},[n("div",{staticClass:"CertificateContentTextItem"},[t._v(t._s("郵件"==t.form.CertType?"%cust":"%cmname")+" = 使用者姓名")]),n("div",{staticClass:"CertificateContentTextItem"},[t._v("%name = 活動名稱")]),n("div",{staticClass:"CertificateContentTextItem"},[t._v("%unit = 主辦單位")]),n("div",{staticClass:"CertificateContentTextItem"},[t._v("%actcg = 種類")]),n("div",{staticClass:"CertificateContentTextItem"},[t._v("%acttype = 活動型態")]),n("div",{staticClass:"CertificateContentTextItem"},[t._v("%area = 活動地點")]),n("div",{staticClass:"CertificateContentTextItem"},[t._v("%begin = 開始日期")]),n("div",{staticClass:"CertificateContentTextItem"},[t._v("%end = 結束日期")]),n("div",{staticClass:"CertificateContentTextItem"},[t._v("%hours = 時數")]),n("div",{staticClass:"CertificateContentTextItem"},[t._v("%regNo = 證書字號")])]):t._e(),n("el-form-item",{attrs:{label:"底稿名稱",prop:"CertName"}},[n("el-input",{model:{value:t.form.CertName,callback:function(e){t.$set(t.form,"CertName",e)},expression:"form.CertName"}})],1),n("el-form-item",{attrs:{label:"底稿主旨",prop:"CertTitle"}},[n("el-input",{model:{value:t.form.CertTitle,callback:function(e){t.$set(t.form,"CertTitle",e)},expression:"form.CertTitle"}})],1),n("el-form-item",{attrs:{label:"底稿內容",prop:"CertContents"}},[n("ckeditor",{model:{value:t.form.CertContents,callback:function(e){t.$set(t.form,"CertContents",e)},expression:"form.CertContents"}})],1),n("el-form-item",{attrs:{label:"備註",prop:"Remark"}},[n("el-input",{model:{value:t.form.Remark,callback:function(e){t.$set(t.form,"Remark",e)},expression:"form.Remark"}})],1)],1),n("div",{staticClass:"formButtonList"},[n("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.sub()}}},[t._v("儲存")]),t.CertificatePreviewShow||"郵件"==t.form.CertType?t._e():n("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.preveiw()}}},[t._v("預覽")]),t.CertificatePreviewShow&&"郵件"!=t.form.CertType?n("el-button",{attrs:{type:"danger"},on:{click:function(e){t.CertificatePreviewShow=!1}}},[t._v("關閉預覽")]):t._e()],1),t.CertificatePreviewShow?n("CertificatePreview",{ref:"Preview",attrs:{user:t.userData,act:t.actData,img:t.CertificateTemp.CertBackImg,text:t.form.CertContents}}):t._e()],1),n("el-table",{staticStyle:{width:"100%"},attrs:{"header-cell-class-name":"tableHeader",data:t.data}},[n("el-table-column",{attrs:{label:"底稿名稱",prop:"CertName"}}),n("el-table-column",{attrs:{label:"底稿類型",prop:"CertType"}}),n("el-table-column",{attrs:{label:"底稿主旨",prop:"CertTitle"}}),n("el-table-column",{attrs:{label:"操作",prop:"ActName"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{staticClass:"iconList"},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"編輯",placement:"top","open-delay":500}},[n("div",{staticClass:"iconListD",on:{click:function(n){return t.editCer(e.row)}}},[n("i",{staticClass:"myicon-edit"})])])],1)]}}])})],1)],1)},a=[],i=n("a34a"),s=n.n(i),c=n("cc6e"),o=n("8a48");function l(t,e,n,r,a,i,s){try{var c=t[i](s),o=c.value}catch(l){return void n(l)}c.done?e(o):Promise.resolve(o).then(r,a)}function u(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var i=t.apply(e,n);function s(t){l(i,r,a,s,c,"next",t)}function c(t){l(i,r,a,s,c,"throw",t)}s(void 0)}))}}var d={props:{data:{type:Array,default:function(){return[]}}},components:{Ck:c["a"],CertificatePreview:o["a"]},data:function(){return{showRowList:!1,showForm:!1,form:{},CertificateTemp:"",CertificatePreviewShow:!1,userData:{Id:1,Sex:"男",Source:"School",UID:"A123456789",UnitCode:"測試單位",UnitName:"測試單位",UserAccount:"Test1234",UserEmail:"Test1234@test.com",UserName:"測試",UserSchool:"測試學校",UserTitle:"測試職稱",regNo:"測試字號00001"}}},watch:{showForm:function(t){this.CertificatePreviewShow=!1}},methods:{editCer:function(t){this.showForm=!0,this.form=JSON.parse(JSON.stringify(t))},sub:function(){var t=this;return u(s.a.mark((function e(){var n;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$store.dispatch("loadingHandler",!0),e.next=3,t.$api.PutCertificateContentByActivityId(t.form).then((function(t){return t.data}));case 3:n=e.sent,t.$alertM.fire({icon:n.success?"success":"error",title:n.msg}),t.$emit("reGetCertificateContent",{ActivityId:t.form.ActivityId}),t.$store.dispatch("loadingHandler",!1),t.showForm=!1;case 8:case"end":return e.stop()}}),e)})))()},preveiw:function(){var t=this;return u(s.a.mark((function e(){return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$store.dispatch("loadingHandler",!0),e.next=3,t.$api.GetActivityById({Id:t.form.ActivityId}).then((function(t){return t.data.response}));case 3:if(t.actData=e.sent,t.actData.CertificateId){e.next=8;break}return t.$alertM.fire({icon:"error",title:"該活動沒設置證書底圖"}),t.$store.dispatch("loadingHandler",!1),e.abrupt("return",0);case 8:return e.next=10,t.$api.GetCertificateContentById({id:t.actData.CertificateId}).then((function(t){return t.data.response}));case 10:t.CertificateTemp=e.sent,t.CertificatePreviewShow=!0,t.$store.dispatch("loadingHandler",!1);case 13:case"end":return e.stop()}}),e)})))()}}},f=d,m=(n("28dc"),n("2877")),p=Object(m["a"])(f,r,a,!1,null,"2b245d38",null);e["a"]=p.exports},9973:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"page"},[t._l(t.pList,(function(e,r){return[e>0&&e<=t.count?n("div",{key:r,staticClass:"pageD",class:{pageDonc:e==t.now},on:{click:function(n){return t.goTo(e)}}},[t._v(t._s(e))]):t._e()]})),t.now?n("select",{domProps:{value:t.now},on:{change:function(e){return t.goTo(e.target.value)}}},t._l(t.count,(function(e,r){return n("option",{key:r,domProps:{value:e}},[t._v(t._s(e+" / "+t.count))])})),0):t._e()],2)},a=[],i={props:["now","count","rightPage","leftPage"],data:function(){return{}},computed:{pList:function(){for(var t=[],e=this.now-this.leftPage;e<=this.now+this.rightPage;e++)t.push(e);return t}},methods:{goTo:function(t){this.$emit("changePage",t)}}},s=i,c=n("2877"),o=Object(c["a"])(s,r,a,!1,null,null,null);e["a"]=o.exports},a34a:function(t,e,n){t.exports=n("96cf")},c297:function(t,e,n){"use strict";var r=n("e3ff"),a=n.n(r);a.a},cc6e:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{style:{width:t.width},attrs:{id:"ckComp"}},[n("ckeditor",{attrs:{value:t.value},on:{input:t.updata}})],1)},a=[],i={name:"Ck",props:["value","width"],data:function(){return{ckContent:""}},methods:{updata:function(t){this.$emit("input",t)}}},s=i,c=(n("c297"),n("2877")),o=Object(c["a"])(s,r,a,!1,null,null,null);e["a"]=o.exports},e3ff:function(t,e,n){},e6dd:function(t,e,n){}}]);
//# sourceMappingURL=chunk-2adf8b3a.4cef56f9.js.map